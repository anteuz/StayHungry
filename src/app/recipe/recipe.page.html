<ion-header>
    <ion-toolbar>
        <ion-title>Recipe</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
    <ion-card>
        <ion-img *ngIf="mode === 'view'" [src]="recipe.imageURI" alt="Picture of {{recipe.name}}" align-items-center justify-content-center class="recipeImage"></ion-img>
        <ion-img *ngIf="mode === 'edit' && downloadURL == null" alt="Picture of this item" [src]="recipe.imageURI" align-items-center justify-content-center class="recipeImage"></ion-img>
        <ion-img *ngIf="(mode === 'new' || mode === 'edit') && downloadURL != null" [src]="downloadURL | async" alt="Picture of this item" align-items-center justify-content-center class="recipeImage"></ion-img>
        <ion-img *ngIf="mode === 'new' && downloadURL == null" alt="Picture of this item" src="assets/images/No_image_available.svg" align-items-center justify-content-center class="recipeImage"></ion-img>
        <ion-item *ngIf="(mode === 'new' || mode === 'edit') && !platformTypeCordova" type="button">
            <ion-icon name="camera" slot="start"></ion-icon>
            <ion-label for="fileInput">
                <input type="file" capture accept="image/*" (change)="onChangeImageUpload($event)" id="fileInput"/>
            </ion-label>
        </ion-item>
        <ion-item *ngIf="mode === 'new' || mode === 'edit' && platformTypeCordova" lines="none">
            <ion-button fill="clear" (click)="getRecipeImageFromCamera()">
                <ion-icon name="add" slot="start"></ion-icon>
                <ion-label *ngIf="recipe.imageURI != null">Edit image</ion-label>
                <ion-label *ngIf="recipe.imageURI == null">Add image</ion-label>
            </ion-button>
        </ion-item>
        <ion-card-header>
            <ion-card-title>
                <ion-label *ngIf="mode === 'view'">{{recipe.name}}</ion-label>
                <ion-label *ngIf="mode === 'new' || mode === 'edit'" position="stacked">Recipe name</ion-label>
                <ion-input *ngIf="mode === 'new' || mode === 'edit'" placeholder="Type here..." formControlName="recipeName"></ion-input>
            </ion-card-title>
            <ion-card-subtitle>
                <ion-label *ngIf="mode === 'view'">{{recipe.description}}</ion-label>
                <ion-label *ngIf="mode === 'new' || mode === 'edit'" position="stacked">Recipe description</ion-label>
                <ion-input *ngIf="mode === 'new' || mode === 'edit'" placeholder="Optional" formControlName="recipeDescription"></ion-input>
            </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
            <ion-item class="noPadding" lines="none">
                <ion-label position="stacked">Recipe category</ion-label>
                <ion-segment scrollable (ionChange)="segmentChanged($event)" [value]="recipe.category" [disabled]="mode === 'view' ? true : false">
                    <ion-segment-button value="all">
                        <ion-icon name="globe" ariaLabel="All"></ion-icon>
                        <ion-label>All</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="basicStuff">
                        <ion-icon name="basket" ariaLabel="Basic stuff"></ion-icon>
                        <ion-label>Basic</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="food">
                        <ion-icon name="pizza"></ion-icon>
                        <ion-label>Food</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="drinks">
                        <ion-icon name="wine"></ion-icon>
                        <ion-label>Drinks</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="desserts">
                        <ion-icon name="ice-cream"></ion-icon>
                        <ion-label>Desserts</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="householdUtilities">
                        <ion-icon name="construct"></ion-icon>
                        <ion-label>Household</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="apothecary">
                        <ion-icon name="medkit"></ion-icon>
                        <ion-label>Health</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="clothes">
                        <ion-icon name="shirt"></ion-icon>
                        <ion-label>Clothes</ion-label>
                    </ion-segment-button>
                </ion-segment>
            </ion-item>

            <!-- Recipe Instructions Section -->
            <ion-item *ngIf="recipe.recipeInstructions && recipe.recipeInstructions.length > 0" class="noPadding" lines="none">
                <ion-label>Recipe Instructions</ion-label>
                <ion-button fill="clear" (click)="toggleInstructions()" slot="end">
                    <ion-icon [name]="showInstructions ? 'chevron-up' : 'chevron-down'" slot="icon-only"></ion-icon>
                </ion-button>
            </ion-item>
            
            <ion-list *ngIf="showInstructions && recipe.recipeInstructions && recipe.recipeInstructions.length > 0">
                <ion-item *ngFor="let instruction of recipe.recipeInstructions; let i = index" lines="none">
                    <ion-label>
                        <h3><strong>{{i + 1}}.</strong> {{instruction}}</h3>
                    </ion-label>
                </ion-item>
            </ion-list>

            <!-- Recipe Tags Section -->
            <ion-item *ngIf="recipe.tags && recipe.tags.length > 0" class="noPadding" lines="none">
                <ion-label>Tags</ion-label>
            </ion-item>
            <ion-chip-list *ngIf="recipe.tags && recipe.tags.length > 0">
                <ion-chip *ngFor="let tag of recipe.tags" color="primary" outline>
                    <ion-label>{{tag}}</ion-label>
                </ion-chip>
            </ion-chip-list>

            <!-- Source URL Section -->
            <ion-item *ngIf="recipe.sourceUrl" class="noPadding" lines="none">
                <ion-label>Source</ion-label>
                <ion-button fill="clear" slot="end" (click)="openSourceUrl(recipe.sourceUrl)">
                    <ion-icon name="open-outline" slot="icon-only"></ion-icon>
                </ion-button>
            </ion-item>

            <!-- Recipe Ingredients Section -->
            <ion-item *ngIf="recipe.recipeIngredient && recipe.recipeIngredient.length > 0" class="noPadding" lines="none">
                <ion-icon name="list" slot="start" color="secondary"></ion-icon>
                <ion-label>
                    <h3>Ingredients ({{ recipe.recipeIngredient?.length || 0 }})</h3>
                </ion-label>
            </ion-item>
            
            <ion-list *ngIf="recipe.recipeIngredient && recipe.recipeIngredient.length > 0">
                <ion-item *ngFor="let ingredient of recipe.recipeIngredient; let i = index">
                    <ion-label>
                        <p>{{ ingredient }}</p>
                    </ion-label>
                </ion-item>
            </ion-list>
            
            <ion-item *ngIf="!recipe.recipeIngredient || recipe.recipeIngredient.length === 0" color="warning">
                <ion-icon name="warning" slot="start"></ion-icon>
                <ion-label>
                    <p>No ingredients found</p>
                </ion-label>
            </ion-item>

        </ion-card-content>
        <ion-grid *ngIf="mode === 'view'">
            <ion-row>
                <ion-col size="12" size-sm>
                    <ion-button fill="clear" size="small" (click)="onAddIngredients()">
                        <ion-icon slot="start" name="basket"></ion-icon>
                        <div>To Shopping List</div>
                    </ion-button>
                </ion-col>
                <ion-col size="12" size-sm>
                    <ion-button fill="clear" size="small" (click)="onEditRecipe()">
                        <ion-icon slot="start" name="create"></ion-icon>
                        <div>Edit Recipe</div>
                    </ion-button>
                </ion-col>
                <ion-col size="12" size-sm>
                    <ion-button fill="clear" size="small" (click)="onDeleteRecipe()" color="danger">
                        <ion-icon slot="start" name="trash"></ion-icon>
                        <div>Remove Recipe</div>
                    </ion-button>
                </ion-col>
            </ion-row>
        </ion-grid>

        <ion-grid *ngIf="mode === 'new' || mode === 'edit'">
            <ion-row>
                <ion-col size="12" size-sm>
                    <ion-button fill="clear" size="small" type="submit">
                        <ion-icon slot="start" name="save"></ion-icon>
                        <div>Save changes</div>
                    </ion-button>
                </ion-col>
                <ion-col size="12" size-sm>
                    <ion-button fill="clear" size="small" (click)="onCancel()">
                        <ion-icon slot="start" name="arrow-back" color="warning"></ion-icon>
                        <div>Cancel</div>
                    </ion-button>
                </ion-col>
            </ion-row>
        </ion-grid>
    </ion-card>
    </form>
</ion-content>
