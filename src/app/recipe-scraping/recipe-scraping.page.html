<ion-header>
  <ion-toolbar color="secondary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Import Recipe from URL</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="scraping-container">
    <!-- URL Input Section -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="link" color="primary"></ion-icon>
          Recipe URL
        </ion-card-title>
        <ion-card-subtitle>
          Enter a recipe URL from supported websites
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Recipe URL</ion-label>
          <ion-input 
            [(ngModel)]="url" 
            placeholder="https://www.k-ruoka.fi/reseptit/..."
            type="url"
            clearInput="true">
          </ion-input>
        </ion-item>
        
        <ion-button 
          expand="block" 
          color="primary" 
          (click)="scrapeRecipe()"
          [disabled]="!url.trim() || isLoading"
          class="scrape-button">
          <ion-icon name="download" slot="start"></ion-icon>
          {{ isLoading ? 'Scraping...' : 'Scrape Recipe' }}
        </ion-button>
        
        <ion-button 
          expand="block" 
          fill="clear" 
          color="medium" 
          (click)="clearForm()"
          [disabled]="isLoading">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Clear
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Error Message -->
    <ion-card *ngIf="errorMessage" color="danger">
      <ion-card-content>
        <ion-icon name="warning" slot="start"></ion-icon>
        {{ errorMessage }}
      </ion-card-content>
    </ion-card>

    <!-- Scraped Recipe Preview -->
    <ion-card *ngIf="scrapedRecipe" class="recipe-preview">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="restaurant" color="success"></ion-icon>
          Recipe Preview
        </ion-card-title>
        <ion-card-subtitle>
          Review the scraped recipe before saving
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <!-- Recipe Image -->
        <div class="recipe-image-container" *ngIf="scrapedRecipe.image && scrapedRecipe.image.length > 0">
          <ion-img 
            [src]="scrapedRecipe.image[0]" 
            [alt]="scrapedRecipe.name"
            class="recipe-image">
          </ion-img>
        </div>
        
        <!-- Recipe Name -->
        <ion-item>
          <ion-label>
            <h2><strong>{{ scrapedRecipe.name }}</strong></h2>
            <p *ngIf="scrapedRecipe.description">{{ scrapedRecipe.description }}</p>
          </ion-label>
        </ion-item>
        
        <!-- Recipe Details -->
        <ion-item *ngIf="scrapedRecipe.recipeYield">
          <ion-icon name="people" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Servings</h3>
            <p>{{ scrapedRecipe.recipeYield }}</p>
          </ion-label>
        </ion-item>
        
        <!-- Ingredients -->
        <ion-item>
          <ion-icon name="list" slot="start" color="secondary"></ion-icon>
          <ion-label>
            <h3>Ingredients ({{ scrapedRecipe.recipeIngredient.length }})</h3>
          </ion-label>
        </ion-item>
        
        <ion-list>
          <ion-item *ngFor="let ingredient of scrapedRecipe.recipeIngredient; let i = index">
            <ion-label>
              <p>{{ ingredient }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
        
        <!-- Instructions -->
        <ion-item>
          <ion-icon name="book" slot="start" color="tertiary"></ion-icon>
          <ion-label>
            <h3>Instructions ({{ scrapedRecipe.recipeInstructions.length }})</h3>
          </ion-label>
        </ion-item>
        
        <ion-list>
          <ion-item *ngFor="let instruction of scrapedRecipe.recipeInstructions; let i = index">
            <ion-label>
              <h4>Step {{ i + 1 }}</h4>
              <p>{{ instruction }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
        
        <!-- Source URL -->
        <ion-item *ngIf="scrapedRecipe.sourceUrl">
          <ion-icon name="globe" slot="start" color="medium"></ion-icon>
          <ion-label>
            <h3>Source</h3>
            <p>{{ scrapedRecipe.sourceUrl }}</p>
          </ion-label>
        </ion-item>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <ion-button 
            expand="block" 
            color="success" 
            (click)="saveRecipe()"
            class="save-button">
            <ion-icon name="save" slot="start"></ion-icon>
            Save Recipe
          </ion-button>
          
          <ion-button 
            expand="block" 
            fill="outline" 
            color="medium" 
            (click)="clearForm()">
            <ion-icon name="close" slot="start"></ion-icon>
            Cancel
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Supported Sites Info -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle" color="primary"></ion-icon>
          Supported Websites
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>K-Ruoka.fi</h3>
              <p>Finnish recipe website</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Valio.fi</h3>
              <p>Finnish dairy recipes</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Kotikokki.net</h3>
              <p>Finnish cooking community</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="information-circle" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>Other Sites</h3>
              <p>May work with JSON-LD structured data</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
